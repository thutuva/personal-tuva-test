version: 2

models:
# Claims Preprocessing
## Final
  - name: data_quality__claims_preprocessing_summary
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: claims_preprocessing_summary
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table
    tests:
      - claims_preprocessing_pipeline_checks:
          config:
            severity: warn
    columns:
      - name: source_table
        description: Table this test category is in reference to
        tests:
          - not_null
      - name: test_category
        description: Category of test
        tests:
          - not_null
      - name: counts
        description: >
          Aggregated counts of all tests in this category and table that failed
        data_type: integer
      - name: tuva_last_run
        description: >
          The last time the data was refreshed.  Generated by 
          `dbt_utils.pretty_time` as the local time of the `dbt run` 
          environment.  Timezone is configurable via the `tuva_last_run` var.

  - name: data_quality__claims_preprocessing_test_detail
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: claims_preprocessing_test_detail
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table
    columns:
      - name: source_table
        description: Table this test is in reference to
        tests:
          - not_null
      - name: test_category
        description: Category of test
        tests:
          - not_null
      - name: test_name
        description: Name of the test being performed
        tests:
          - not_null
      - name: grain
        description: Grain of the test
      - name: claim_type
        description: Specific claim type, if any, that this test is specific to
      - name: pipeline_test
        description: Flag to indicate a pipeline stopping test
      - name: foreign_key
        description: >
          The column this table can be used to join back to the source table
      - name: data_source
        description: >
          User-configured field that indicates the data source (e.g. typically 
          named after the payer and state "BCBS Tennessee").
      - name: tuva_last_run
        description: >
          The last time the data was refreshed.  Generated by 
          `dbt_utils.pretty_time` as the local time of the `dbt run` 
          environment.  Timezone is configurable via the `tuva_last_run` var.

  - name: data_quality__claims_preprocessing_test_result
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: claims_preprocessing_test_result
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table
    columns:
      - name: source_table
        description: Table this test is in reference to
        tests:
          - not_null
      - name: grain
        description: Grain of the test
      - name: test_category
        description: Category of test
        tests:
          - not_null
      - name: test_name
        description: Name of the test being performed
        tests:
          - not_null
      - name: claim_type
        description: Specific claim type, if any, that this test is specific to
      - name: pipeline_test
        description: Flag to indicate a pipeline stopping test
      - name: failures
        description: Number of failures of this test
        data_type: integer
      - name: denominator
        description: Total number of records analyzed for this test
        data_type: integer
      - name: tuva_last_run
        description: >
          The last time the data was refreshed.  Generated by 
          `dbt_utils.pretty_time` as the local time of the `dbt run` 
          environment.  Timezone is configurable via the `tuva_last_run` var.

  - name: data_quality__claims_preprocessing_use_case
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: claims_preprocessing_use_case
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table
    columns:
      - name: use_case
        description: The mart or logic that would be affected by test failures
        tests:
          - not_null
      - name: source_table
        description: Table this use case is in reference to
        tests:
          - not_null
      - name: test_name
        description: Name of the test being performed
        tests:
          - not_null
      - name: failures
        description: Number of failures of this test
        data_type: integer
      - name: denominator
        description: Total number of records analyzed for this test
        data_type: integer
      - name: tuva_last_run
        description: >
          The last time the data was refreshed.  Generated by 
          `dbt_utils.pretty_time` as the local time of the `dbt run` 
          environment.  Timezone is configurable via the `tuva_last_run` var.

## Intermediate
###  eligibility
  - name: data_quality__claims_preprocessing_eligibility_duplicates
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_eligibility_duplicates
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_eligibility_invalid_values
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_eligibility_invalid_values
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_eligibility_missing_values
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_eligibility_missing_values
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_test_result_stage_eligibility
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_test_result_stage_eligibility
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_eligibility_denominators
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_eligibility_denominators
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_eligibility_plausibility
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_eligibility_plausibility
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_test_detail_stage_eligibility
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_test_detail_stage_eligibility
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

### medical claim
  - name: data_quality__claims_preprocessing_claim_type_unmapped
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_claim_type_unmapped
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_institutional_header_fail_details
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_institutional_header_fail_details
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_professional_header_fail_details
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_professional_header_fail_details
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_pharmacy_header_fail_details
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_pharmacy_header_fail_details
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_invalid_values
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_invalid_values
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_line_numbers
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_line_numbers
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_inst_missing_values
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_inst_missing_values
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_invalid_npi
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_invalid_npi
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_prof_missing_values
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_prof_missing_values
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_claim_type_mapping_failures
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_claim_type_mapping_failures
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_duplicates
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_duplicates
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_test_result_stage_medical_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_test_result_stage_medical_claim
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_denominators
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_denominators
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_plausibility
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_plausibility
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_dates
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_dates
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_medical_claim_dates_inst
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_medical_claim_dates_inst
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_test_detail_stage_medical_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_test_detail_stage_medical_claim
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

###  pharmacy_claim
  - name: data_quality__claims_preprocessing_pharmacy_claim_duplicates
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_pharmacy_claim_duplicates
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_pharmacy_claim_line_numbers
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_pharmacy_claim_line_numbers
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_pharmacy_claim_missing_values
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_pharmacy_claim_missing_values
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_test_result_stage_pharmacy_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_test_result_stage_pharmacy_claim
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table

  - name: data_quality__claims_preprocessing_test_detail_stage_pharmacy_claim
    config:
      schema: |
        {%- if var('tuva_schema_prefix',None) != None -%}{{var('tuva_schema_prefix')}}_data_quality
        {% else %}data_quality{%- endif -%}
      alias: _int_claims_preprocessing_test_detail_stage_pharmacy_claim
      tags:
        - data_quality
        - claims_preprocessing
      materialized: table
